<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Employee Login Tracker</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 600px;
      margin: auto;
      padding: 20px;
    }
    label, select, input, button {
      display: block;
      width: 100%;
      margin-bottom: 15px;
      padding: 8px;
      font-size: 16px;
    }
    #timerDisplay {
      font-size: 24px;
      text-align: center;
      margin: 15px 0;
    }
  </style>
</head>
<body>
  <h2>Employee Login Tracker</h2>

  <label for="name">Name</label>
  <select id="name" name="name" autocomplete="off" autocorrect="off" spellcheck="false" inputmode="none">
    <option value="Tarun">Tarun</option>
    <option value="Yuvraj">Yuvraj</option>
    <option value="Aman">Aman</option>
    <option value="Art">Art</option>
    <option value="Anurag">Anurag</option>
    <option value="PrithviRaj">PrithviRaj</option>
    <option value="Charlie">Charlie</option>
    <option value="Vaishnavi">Vaishnavi</option>
    <option value="Lakshika">Lakshika</option>
  </select>

  <label for="email">Email</label>
  <input type="email" id="email" required autocomplete="on" autocorrect="off" spellcheck="false" />

  <div id="timerDisplay">00:00:00</div>

  <button onclick="handleLogin()">Login</button>
  <button onclick="startBreak()">Break In</button>
  <button onclick="endBreak()">Break Out</button>
  <button onclick="handleLogout()">Logout & Submit</button>

  <input type="hidden" id="loginTime" />
  <input type="hidden" id="logoutTime" />
  <input type="hidden" id="totalDuration" />
  <input type="hidden" id="breakDuration" />
  <input type="hidden" id="workDuration" />
  <input type="hidden" id="breakDetails" />
  <input type="hidden" id="breakInTimes" />

  <script>
    const loginTimeInput = document.getElementById("loginTime");
    const logoutTimeInput = document.getElementById("logoutTime");
    const totalDurationInput = document.getElementById("totalDuration");
    const breakDurationInput = document.getElementById("breakDuration");
    const workDurationInput = document.getElementById("workDuration");
    const breakDetailsInput = document.getElementById("breakDetails");
    const breakInTimesInput = document.getElementById("breakInTimes");
    const timerDisplay = document.getElementById("timerDisplay");

    let breaks = [];
    let breakInTime = null;
    let timerInterval;

    function startTimer(startTime) {
      clearInterval(timerInterval);
      timerInterval = setInterval(() => {
        const now = new Date();
        const elapsed = new Date(now - startTime);
        const hrs = String(elapsed.getUTCHours()).padStart(2, '0');
        const mins = String(elapsed.getUTCMinutes()).padStart(2, '0');
        const secs = String(elapsed.getUTCSeconds()).padStart(2, '0');
        timerDisplay.textContent = `${hrs}:${mins}:${secs}`;
      }, 1000);
    }

    function calculateDuration(start, end) {
      const ms = end - start;
      const date = new Date(ms);
      return `${String(date.getUTCHours()).padStart(2, '0')}:${String(date.getUTCMinutes()).padStart(2, '0')}:${String(date.getUTCSeconds()).padStart(2, '0')}`;
    }

    function calculateBreakDuration() {
      return breaks.reduce((acc, curr) => acc + (new Date(curr.end) - new Date(curr.start)), 0);
    }

    function subtractDurations(total, breakMs) {
      const [h, m, s] = total.split(":" ).map(Number);
      const totalMs = h * 3600000 + m * 60000 + s * 1000;
      const workMs = totalMs - breakMs;
      const date = new Date(workMs);
      return `${String(date.getUTCHours()).padStart(2, '0')}:${String(date.getUTCMinutes()).padStart(2, '0')}:${String(date.getUTCSeconds()).padStart(2, '0')}`;
    }

    function handleLogin() {
      const loginTime = new Date().toISOString();
      loginTimeInput.value = loginTime;
      localStorage.setItem("loginTime", loginTime);
      localStorage.setItem("isLoggedIn", "true");
      startTimer(new Date(loginTime));
    }

    function handleLogout() {
      const logoutTime = new Date().toISOString();
      logoutTimeInput.value = logoutTime;

      const loginDate = new Date(loginTimeInput.value);
      const logoutDate = new Date(logoutTime);
      const totalDuration = calculateDuration(loginDate, logoutDate);
      const breakMs = calculateBreakDuration();
      const breakDuration = new Date(breakMs);
      const breakStr = `${String(breakDuration.getUTCHours()).padStart(2, '0')}:${String(breakDuration.getUTCMinutes()).padStart(2, '0')}:${String(breakDuration.getUTCSeconds()).padStart(2, '0')}`;
      const workDuration = subtractDurations(totalDuration, breakMs);

      totalDurationInput.value = totalDuration;
      breakDurationInput.value = breakStr;
      workDurationInput.value = workDuration;
      breakDetailsInput.value = JSON.stringify(breaks);
      breakInTimesInput.value = JSON.stringify(breaks.map(b => b.start));

      localStorage.removeItem("isLoggedIn");
      localStorage.removeItem("loginTime");
      localStorage.removeItem("breaks");
      localStorage.removeItem("breakInTime");

      clearInterval(timerInterval);
      timerDisplay.textContent = "00:00:00";

      sendData();
    }

    function startBreak() {
      breakInTime = new Date();
      localStorage.setItem("breakInTime", breakInTime.toISOString());
    }

    function endBreak() {
      const breakEndTime = new Date();
      breaks.push({ start: breakInTime, end: breakEndTime });
      localStorage.removeItem("breakInTime");
      localStorage.setItem("breaks", JSON.stringify(breaks));
    }

    function sendData() {
      const data = {
        name: document.getElementById("name").value,
        email: document.getElementById("email").value,
        loginTime: loginTimeInput.value,
        logoutTime: logoutTimeInput.value,
        totalDuration: totalDurationInput.value,
        breakDuration: breakDurationInput.value,
        workDuration: workDurationInput.value,
        breakDetails: breakDetailsInput.value,
        breakInTimes: breakInTimesInput.value,
      };

      fetch("https://script.google.com/macros/s/AKfycbzEdniBWPYGRj8-0Fhdhf5fuGdDw1JF5NzAXDIO61IHFOty9360m0QDcvRSNO059Om6Ag/exec", {
        method: "POST",
        mode: "no-cors",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify(data),
      });
    }

    window.onload = function () {
      if (localStorage.getItem("isLoggedIn") === "true") {
        const storedLoginTime = localStorage.getItem("loginTime");
        if (storedLoginTime) {
          loginTimeInput.value = storedLoginTime;
          startTimer(new Date(storedLoginTime));
        }

        const storedBreaks = localStorage.getItem("breaks");
        if (storedBreaks) {
          breaks = JSON.parse(storedBreaks);
        }

        const storedBreakIn = localStorage.getItem("breakInTime");
        if (storedBreakIn) {
          breakInTime = new Date(storedBreakIn);
        }
      }
    };

    window.addEventListener("beforeunload", function (e) {
      if (localStorage.getItem("isLoggedIn") === "true") {
        e.preventDefault();
        e.returnValue = "You have an active session. Are you sure you want to leave?";
      }
    });
  </script>
</body>
</html>
